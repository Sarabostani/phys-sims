<!DOCTYPE html>
<html>
<head>
<title>Newton Cannon</title>
<link rel="stylesheet" type="text/css" href="../style.css" />
<style>
#zoomin{
	width:30px;
	position:absolute;
	left:870px;
	top:.5em;
}
#zoomout{
	width:30px;
	position:absolute;
	left:870px;
	top:2.5em;
}
#start{
	position:absolute;
	left:850px;
	top:5.0em;
}
</style>
</head>

<body>
<img id="earth" src="earth.png" style="width:500px;visibility:hidden;display:none" width="500px" />
<img id="mountain" src="mountain.png" style="width:500px;visibility:hidden;display:none" />
<div id="container">
	<input id="zoomin" type="button" value="+" />
	<input id="zoomout" type="button" value="-" />
	<input id="start" type="button" value="Start" />
	<canvas width="900" height="500" id="canvas">Your browser doesn't support canvas.</canvas>
</div>

<script src="../lib/utils.js"></script>
<script src="../lib/ball.js"></script>

<script>

/****************************
* INITIALIZING VALUES AND VARIABLES
******************************/

var earth = {
	radius : 200,
	center : new Point(450,250)
};

var ball = new Ball('red',0.2);

var earthImg = document.getElementById("earth");
var mountain = document.getElementById("mountain");

var trace = new Array();

function initValues(){

	ball.x = earth.center.x - 10; 
	ball.y = earth.center.y - earth.radius - ball.radius - 5;

	ball.vx = 1;
	ball.ay = 0.005;
}


document.getElementById('zoomin').addEventListener('click',zoomIn);
document.getElementById('zoomout').addEventListener('click',zoomOut);
document.getElementById('start').addEventListener('click',start);

/**************
* HANDLING ZOOM
****************/
var zoomPoint = new Point(earth.center.x + 10, earth.center.y - earth.radius - 4);
var scaleFactor = 1.8;
var zoomLimit = 1;

function zoomIn(){
	if(zoomLimit < 8){
		zoomToPoint(zoomPoint,scaleFactor,'in');
		++zoomLimit;	
	}
}
function zoomOut(){
	if(zoomLimit > 1){
		zoomToPoint(zoomPoint,scaleFactor,'out');
		--zoomLimit;		
	}
}

/**********
* ANIMATION START/STOP
***********/

window.onload = function(){
	initValues();
	paint();
	//console.log(distance(ball.center,earth.center));
};

var animating = false;

function start(){
	animating = true;
	startAnimation();
}
function startAnimation(){
	reqAnimID = reqAnimFrame(startAnimation);	
	paint();
}

function stopAnimation(){
	cancelAnim(reqAnimID);
	animating = false;
	console.log('stopped , #of points = ' + trace.length);
}


/*******************
* MAIN PAINT FUNCTION
********************/
function paint(){

	ctx.fillStyle = '#eff';
	ctx.fillRect(0,0,can.width, can.height);
	
	//ctx.clearRect(0,0,can.width,can.height);
	
	ctx.drawImage(earthImg,250,60,400,400);
	ctx.drawImage(mountain,425,43,20,20);
	
	ball.updatePosition();	
	ball.draw();
	
	if(animating){
		trace.push(new Point(ball.x,ball.y));
	}
	
	trace.forEach(function(pt){
		ctx.save();
		ctx.fillStyle = 'red';
		ctx.fillRect(pt.x,pt.y,0.51,0.51);
		ctx.restore();
	});
	
	
	if((distance(ball.center,earth.center) < earth.radius || ball.outOfCanvas() ) && animating == true){
		stopAnimation();
	}
}


lowZoom = 0;
highZoom = 30;
var delta = 1.0;
function handleScroll(evt){

	delta = evt.wheelDelta ? evt.wheelDelta/40 : evt.detail ? -evt.detail : 0;
	
	if(delta < 0 && zoomLimit > lowZoom)
		--zoomLimit;
	else if(delta > 0 && zoomLimit < highZoom)
		++zoomLimit;
	
	if( zoomLimit > lowZoom && zoomLimit < highZoom){
		if (delta) zoomToPoint(delta, point);
		paint();
	}
}

</script>

</body>
</html>

