<!DOCTYPE html>
<html>
<head>
<title>Newton Cannon</title>
<link rel="stylesheet" type="text/css" href="../style.css" />
<style>
#zoomin{
	width:30px;
	position:absolute;
	left:870px;
	top:.5em;
}
#zoomout{
	width:30px;
	position:absolute;
	left:870px;
	top:2.5em;
}
#start{
	position:absolute;
	left:855px;
	top:5.0em;
}
</style>
</head>

<body>
<img id="earth" src="earth.png" style="width:500px;visibility:hidden;display:none" width="500px" />
<img id="mountain" src="mountain.png" style="width:500px;visibility:hidden;display:none" />
<div id="container">
	<input id="zoomin" type="button" value="+" />
	<input id="zoomout" type="button" value="-" />
	<input id="start" type="button" value="Start" />
	<canvas width="900" height="500" id="canvas">Your browser doesn't support canvas.</canvas>
</div>

<script src="../lib/utils.js"></script>
<script src="../lib/ball.js"></script>

<script>
var earth = {
	radius : 200,
	center : new Point(450,250)
};

var ball = new Ball('red',0.2);
ball.x = earth.center.x - 10; ball.y = earth.center.y - earth.radius - ball.radius - 5;

ball.vx = 1;
ball.ay = 0.005;

var earthImg = document.getElementById("earth");
var mountain = document.getElementById("mountain");

var point = new Point(earth.center.x, earth.center.y - earth.radius - 4);

var scaleFactor = 1.8;
var zoomLimit = 1;

var trace = new Array();

document.getElementById('zoomin').addEventListener('click',zoomIn);
document.getElementById('zoomout').addEventListener('click',zoomOut);
document.getElementById('start').addEventListener('click',start);

function zoomIn(){
	if(zoomLimit < 11){
		zoomToPoint(point,scaleFactor,'in');
		++zoomLimit;	
	}
}
function zoomOut(){
	if(zoomLimit > 1){
		zoomToPoint(point,scaleFactor,'out');
		--zoomLimit;		
	}
}

//document.getElementById("canvas").addEventListener('click', startAnim);
window.onload = function(){
	paint();
	console.log(distance(ball.center,earth.center));
};

function start(){
	animating = true;
	startAnim();
}
function startAnim(){
	reqAnimID = reqAnimFrame(startAnim);	
	paint();
}

var animating = false;

/*setInterval(function(){
	if(animating)
		//console.log('push');
		points.push(new Point(ball.x,ball.y));
		
},100);*/

var i = 0;
function paint(){

	ctx.fillStyle = '#eff';
	ctx.fillRect(0,0,can.width, can.height);
	
	//ctx.clearRect(0,0,can.width,can.height);
	
	ctx.drawImage(earthImg,250,60,400,400);
	ctx.drawImage(mountain,425,43,20,20);
	
	/*ctx.fillStyle = "#acabff";
	ctx.beginPath();
	ctx.arc(earth.center.x,earth.center.y, earth.radius, 0, 2*Math.PI)
	ctx.fill();*/
	
	ball.updatePosition();	
	ball.draw();
	
	/*for( i = 0; i < points.length - 1 ; i++){
		ctx.save();
		ctx.fillStyle= '#ff0000' ;
		ctx.beginPath();
		ctx.moveTo(points[i].x,points[i].y);
		ctx.lineTo(points[i+1].x,points[i+1].y);
		ctx.stroke();
		ctx.restore();
	}*/
	
	if(animating){
		trace.push(new Point(ball.x,ball.y));
	}
	
	trace.forEach(function(pt){
		ctx.save();
		ctx.fillStyle = 'red';
		ctx.fillRect(pt.x,pt.y,0.51,0.51);
		ctx.restore();
	});
	
	
	if((distance(ball.center,earth.center) < earth.radius || ball.outOfCanvas() ) && animating == true){
		cancelAnim(reqAnimID);
		animating = false;
		console.log('stopped , #of points = ' + trace.length);
	}
}


lowZoom = 0;
highZoom = 30;
var delta = 1.0;
function handleScroll(evt){

	delta = evt.wheelDelta ? evt.wheelDelta/40 : evt.detail ? -evt.detail : 0;
	
	if(delta < 0 && zoomLimit > lowZoom)
		--zoomLimit;
	else if(delta > 0 && zoomLimit < highZoom)
		++zoomLimit;
	
	if( zoomLimit > lowZoom && zoomLimit < highZoom){
		if (delta) zoomToPoint(delta, point);
		paint();
	}
}

</script>

</body>
</html>

